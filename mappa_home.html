
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mappa OpenLayers - Bosnia con Controlli</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css" />
    <style>
        html, body, #map {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            font-family: Arial, sans-serif;
        }

        /* Controlli personalizzati */
        .custom-control {
            position: absolute;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-control:hover {
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        /* Basemap Switcher */
        .basemap-switcher {
            top: 5px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Overlay Switcher */
        .overlay-switcher {
            top: 50px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Zoom Controls */
        .zoom-controls {
            top: 5px;
            left: 10px;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            background: rgba(255, 255, 255, 1);
        }

        /* Fullscreen */
        .fullscreen-control {
            top: 60px;
            left: 9px;
            width: 6px;
            height: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        /* Back to Map */
        .back-to-map {
            bottom: 40px;
            right: 10px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #007acc;
            color: #007acc;
            font-weight: bold;
        }

        .back-to-map:hover {
            background: #ffff;
            color: white;
        }

        /* Coordinate Display */
        .coordinate-display {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.8);
            color: rgb(0, 0, 0);
            padding: 8px 8px;
            border-radius: 4px;
            font-family: vary();
            font-size: px;
            min-width: 100px;
        }

        /* Scale Control */
        .scale-control {
            position: absolute;
            bottom: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            border: 1px solid #ccc;
        }

        /* Toggle switches */
        .toggle-switch {
            position: relative;
            width: 40px;
            height: 20px;
            background: #ccc;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toggle-switch.active {
            background: #007acc;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(20px);
        }

        /* Icons usando caratteri Unicode */
        .icon-globe::before { content: "üåç"; }
        .icon-layers::before { content: "üìã"; }
        .icon-fullscreen::before { content: "‚õ∂"; }
        .icon-home::before { content: "üè†"; }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <!-- Coordinate Display -->
    <div id="coordinateDisplay" class="coordinate-display" style="display: none;">
        <div>Lat: <span id="lat">0.000000</span>¬∞</div>
        <div>Lon: <span id="lon">0.000000</span>¬∞</div>
    </div>

    <!-- Scale Control -->
    <div id="scaleControl" class="scale-control">
        Scala: <span id="scaleValue">--</span>
    </div>

    <!-- Basemap Switcher -->
    <div class="custom-control basemap-switcher">
        <span class="icon-globe"></span>
        <select id="basemapSelect">
            <option value="osm">OpenStreetMap</option>
            <option value="satellite">Satellite</option>
        </select>
    </div>

    <!-- Overlay Switcher -->
    <div class="custom-control overlay-switcher">
        <span class="icon-layers"></span>
        <label>Bosnia Boundaries</label>
        <div id="overlayToggle" class="toggle-switch active">
            <div class="toggle-slider"></div>
        </div>
    </div>

    <!-- Zoom Controls -->
    <div class="zoom-controls">
        <div id="zoomIn" class="zoom-btn">+</div>
        <div id="zoomOut" class="zoom-btn">‚àí</div>
    </div>

    <!-- Fullscreen Control -->
    <div id="fullscreenBtn" class="custom-control fullscreen-control" title="Modalit√† Schermo Intero">
        <span class="icon-fullscreen"></span>
    </div>

    <!-- Back to Map -->
    <div id="backToMap" class="custom-control back-to-map">
        <span class="icon-home"></span> Reset Vista
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>
    <script>
        // Layer OSM base
        const osmLayer = new ol.layer.Tile({
            source: new ol.source.OSM()
        });

        // Layer Satellite (Bing)
        const satelliteLayer = new ol.layer.Tile({
            source: new ol.source.XYZ({
                url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
                attributions: 'Tiles ¬© Esri'
            }),
            visible: false
        });

        // Overlay WMS Bosnia Boundaries
        const bosniaBoundaryLayer = new ol.layer.Image({
            source: new ol.source.ImageWMS({
                url: 'https://www.gis-geoserver.polimi.it/geoserver/gisgeoserver_18/wms',
                params: { 'LAYERS': 'gisgeoserver_18:BOSNIA_BOUNDARIES', 'TILED': true },
                ratio: 1,
                serverType: 'geoserver'
            }),
            visible: true
        });

        // Vista iniziale
        const initialView = {
            center: ol.proj.fromLonLat([17.6791, 43.9159]),
            zoom: 7
        };

        // Creazione mappa
        const map = new ol.Map({
            target: 'map',
            layers: [osmLayer, satelliteLayer, bosniaBoundaryLayer],
            view: new ol.View(initialView)
        });

        // Basemap Switcher
        const basemapSelect = document.getElementById('basemapSelect');
        basemapSelect.addEventListener('change', function() {
            const selectedBasemap = this.value;
            if (selectedBasemap === 'osm') {
                osmLayer.setVisible(true);
                satelliteLayer.setVisible(false);
            } else if (selectedBasemap === 'satellite') {
                osmLayer.setVisible(false);
                satelliteLayer.setVisible(true);
            }
        });

        // Overlay Toggle
        const overlayToggle = document.getElementById('overlayToggle');
        overlayToggle.addEventListener('click', function() {
            const isActive = this.classList.contains('active');
            if (isActive) {
                this.classList.remove('active');
                bosniaBoundaryLayer.setVisible(false);
            } else {
                this.classList.add('active');
                bosniaBoundaryLayer.setVisible(true);
            }
        });

        // Zoom Controls
        document.getElementById('zoomIn').addEventListener('click', function() {
            const view = map.getView();
            const zoom = view.getZoom();
            view.setZoom(zoom + 1);
        });

        document.getElementById('zoomOut').addEventListener('click', function() {
            const view = map.getView();
            const zoom = view.getZoom();
            view.setZoom(zoom - 1);
        });

        // Fullscreen Control
        document.getElementById('fullscreenBtn').addEventListener('click', function() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('Errore fullscreen:', err);
                });
            } else {
                document.exitFullscreen();
            }
        });

        // Back to Map (Reset Vista)
        document.getElementById('backToMap').addEventListener('click', function() {
            const view = map.getView();
            view.animate({
                center: initialView.center,
                zoom: initialView.zoom,
                duration: 1000
            });
        });

        // Coordinate Display
        const coordinateDisplay = document.getElementById('coordinateDisplay');
        const latSpan = document.getElementById('lat');
        const lonSpan = document.getElementById('lon');

        map.on('pointermove', function(event) {
            const coordinate = ol.proj.toLonLat(event.coordinate);
            const [lon, lat] = coordinate;
            
            latSpan.textContent = lat.toFixed(6);
            lonSpan.textContent = lon.toFixed(6);
            coordinateDisplay.style.display = 'block';
        });

        map.getViewport().addEventListener('mouseleave', function() {
            coordinateDisplay.style.display = 'none';
        });

        // Scale Control
        const scaleValue = document.getElementById('scaleValue');
        
        function updateScale() {
            const view = map.getView();
            const resolution = view.getResolution();
            if (resolution) {
                const meters = resolution * 100; // 100 pixel in metri
                if (meters < 1000) {
                    scaleValue.textContent = Math.round(meters) + ' m';
                } else {
                    scaleValue.textContent = (meters / 1000).toFixed(1) + ' km';
                }
            }
        }

        map.getView().on('change:resolution', updateScale);
        updateScale();

        // Inizializza la mappa
        map.on('postrender', function() {
            updateScale();
        });
    </script>
</body>
</html>